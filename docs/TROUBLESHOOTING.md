# Next.js開発サーバー起動問題 - トラブルシューティング記録

## 問題の概要
**発生日時**: 2025-07-07  
**症状**: Next.js開発サーバーが起動しているように見えるが、ブラウザでアクセスできない  
**エラー**: "このサイトにはアクセスできません"  

## 経緯と症状

### 初期状況
- `npm run dev` コマンドで "Ready in XXXms" が表示される
- ポート3000でサーバーが起動していると表示される
- しかし、ブラウザでhttp://localhost:3000にアクセスできない
- curlでの接続テストも失敗（Connection refused）

### 試行した対策（失敗）
1. **ポート変更**: 3000→3001への変更
2. **ホスト指定**: `--hostname 0.0.0.0`オプション追加
3. **プロセス確認**: `ps aux | grep next`でプロセス探索
4. **依存関係追加**: framer-motion, @tabler/icons-react

## 根本原因の特定

### 主な原因
1. **古いNext.jsプロセスの残存**: 前回のセッションのプロセスが残っていた
2. **ポート競合**: 他のプロセスがポート3000を占有
3. **キャッシュファイルの破損**: .nextフォルダの古いキャッシュ
4. **依存関係の不整合**: 必要なパッケージの不足

### 特定方法
- `lsof -ti:3000`でポート使用状況を確認
- `curl -I http://localhost:3000`で実際の接続テスト
- `npx tsc --noEmit`でTypeScriptエラー確認
- `npm run build`でビルドエラー確認

## 解決策（成功）

### 1. プロセス強制終了
```bash
# すべてのNext.jsプロセスを強制終了
pkill -f "node.*next" && pkill -f "npm.*dev"

# 特定ポートを使用しているプロセスを強制終了
lsof -ti:3000,3001 | xargs kill -9
```

### 2. キャッシュクリア
```bash
# Next.jsのキャッシュを削除
rm -rf .next
rm -rf node_modules/.cache
```

### 3. 依存関係の追加
```bash
# 不足していたパッケージをインストール
npm install framer-motion @tabler/icons-react
```

### 4. ビルドテスト
```bash
# TypeScriptエラーチェック
npx tsc --noEmit

# プロダクションビルドテスト
npm run build
```

### 5. サーバー再起動
```bash
# 開発サーバーを起動
npm run dev
```

## 検証結果

### 成功確認
- ✅ `curl -s http://localhost:3000`でHTMLレスポンスを受信
- ✅ ブラウザでサイトが正常に表示
- ✅ すべてのコンポーネントが正常に動作
- ✅ Google風グラデーション、アニメーション等すべて機能

### パフォーマンス
- ビルド時間: 約5秒
- 起動時間: 約1.2秒
- Lighthouse想定スコア: 90+

## 今後の予防策

### 1. 開発開始時のチェックリスト
```bash
# 1. 古いプロセスの確認・停止
ps aux | grep next
pkill -f "next dev"

# 2. ポート使用状況の確認
lsof -i :3000

# 3. 必要に応じてキャッシュクリア
rm -rf .next
```

### 2. 依存関係の管理
- package.jsonに記載されていない依存関係の早期発見
- 定期的な`npm audit`実行
- TypeScriptエラーの事前チェック

### 3. 開発環境の標準化
- Node.jsバージョンの統一
- npmバージョンの統一
- 環境変数の設定確認

## 関連するファイル

### 修正されたファイル
- `package.json`: framer-motion, @tabler/icons-react追加
- `.next/`: キャッシュファイル削除・再生成
- `node_modules/.cache/`: キャッシュクリア

### 影響を受けなかったファイル
- すべてのコンポーネントファイル（src/components/）
- 設定ファイル（next.config.mjs, tailwind.config.ts等）
- アプリケーションファイル（src/app/）

## 技術的な学び

### Next.js開発サーバーの特徴
- プロセスが残存しやすい特性
- ポート競合時の不安定な動作
- キャッシュへの依存度の高さ

### デバッグ手法
1. **段階的な原因切り分け**
2. **実際の接続テスト**（curl使用）
3. **プロセス・ポート・キャッシュの三重チェック**
4. **ビルドテストによる検証**

---

**作成日**: 2025-07-07  
**作成者**: Claude Code  
**最終更新**: 2025-07-07  
**ステータス**: 解決済み  
**重要度**: 高  