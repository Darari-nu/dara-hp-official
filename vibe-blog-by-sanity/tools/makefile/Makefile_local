# vibe-blog-by-sanity ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®š

# ãƒ‘ã‚¹ã®ä¸Šæ›¸ã
APP_DIR = app

# =========================================
# å…±é€šã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…ï¼ˆãƒ™ãƒ¼ã‚¹Makefileã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰
# =========================================
define setup_command
	@echo "$(CYAN)ğŸ“¦ vibe-blog-by-sanity ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™$(NC)"
	@echo "$(YELLOW)â–¶ è‡ªå‹•ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—...$(NC)"
	@cd $(APP_DIR) && rm -rf .firebase .firebaserc .vercel .sanity pglite-debug.log static
	@echo "$(YELLOW)â–¶ Vercel CLI ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«...$(NC)"
	@npm install -g vercel 2>/dev/null || echo "$(YELLOW)âš  Vercel CLI ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™$(NC)"
	@echo "$(YELLOW)â–¶ Sanity CLI ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«...$(NC)"
	@npm install -g @sanity/cli 2>/dev/null || echo "$(YELLOW)âš  Sanity CLI ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™$(NC)"
	@echo "$(YELLOW)â–¶ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«...$(NC)"
	@cd $(APP_DIR) && npm install
	@echo "$(GREEN)âœ… vibe-blog-by-sanity ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼$(NC)"
endef

define preview_command
	@echo "$(GREEN)  - Next.js: http://localhost:4005$(NC)"
	@echo "$(GREEN)  - Sanity Studio: http://localhost:3333$(NC)"
	cd $(APP_DIR) && npm run dev & npm run studio
endef

define dev_command
	cd $(APP_DIR) && PORT=$(DEV_PORT) npm run dev
endef

define deploy_command
	@echo "$(CYAN)â–¶ Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹...$(NC)"
	cd $(APP_DIR) && npm run deploy
	@echo ""
	@echo "$(CYAN)â–¶ Sanity Studioã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹...$(NC)"
	@echo "$(YELLOW)ğŸ“ æ³¨æ„: åˆå›ã®å ´åˆã¯Studioã®ãƒ›ã‚¹ãƒˆåã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™$(NC)"
	cd $(APP_DIR) && npm run studio:deploy || echo "$(YELLOW)âš  Sanity Studioã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ$(NC)"
endef

define clean_command
	cd $(APP_DIR) && rm -rf .next out dist build node_modules/.cache
endef

# =========================================
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç‹¬è‡ªã®ã‚³ãƒãƒ³ãƒ‰
# =========================================
.PHONY: build studio import-contents deploy-studio deploy-app

# ãƒ“ãƒ«ãƒ‰
build: ## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
	cd $(APP_DIR) && npm run build

# Sanity Studio
studio: ## Sanity Studioã‚’èµ·å‹•
	@echo "$(GREEN)Sanity Studio: http://localhost:3333$(NC)"
	cd $(APP_DIR) && npm run studio

# Contentsã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import-contents: ## vibe-blogã®contentsã‚’Sanityã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
	@echo "$(CYAN)â–¶ Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’é–‹å§‹...$(NC)"
	@echo "$(YELLOW)ğŸ“ å‰ææ¡ä»¶:$(NC)"
	@echo "  - SANITY_API_TOKENãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨"
	@echo "  - Sanityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨"
	@echo ""
	@cd $(APP_DIR) && node ../contents/tools/import-contents-to-sanity.js
	@echo "$(GREEN)âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†$(NC)"

# Sanity Studioã®ãƒ‡ãƒ—ãƒ­ã‚¤
deploy-studio: ## Sanity Studioã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
	@echo "$(CYAN)â–¶ Sanity Studioã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹...$(NC)"
	cd $(APP_DIR) && npm run studio:deploy
	@echo "$(GREEN)âœ“ Sanity Studioã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†$(NC)"

# å€‹åˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ï¼‰
deploy-app: ## Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
	@echo "$(CYAN)â–¶ Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹...$(NC)"
	cd $(APP_DIR) && npm run deploy
	@echo "$(GREEN)âœ“ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†$(NC)"

